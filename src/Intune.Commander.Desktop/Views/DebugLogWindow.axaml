<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Intune.Commander.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="500"
        x:Class="Intune.Commander.Desktop.Views.DebugLogWindow"
        x:DataType="vm:DebugLogViewModel"
        Title="Intune Commander â€” Debug Log"
        Width="800" Height="500"
        MinWidth="400" MinHeight="250">

    <Design.DataContext>
        <vm:DebugLogViewModel />
    </Design.DataContext>

    <DockPanel>
        <!-- Toolbar row 1: search + category + action buttons -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                Padding="8,5">
            <DockPanel>
                <!-- Buttons on the right must be declared before the fill child -->
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="6">
                    <Button Content="Copy Selected" Click="OnCopySelected" Padding="10,3" FontSize="12" />
                    <Button Content="Copy All"      Click="OnCopyAll"      Padding="10,3" FontSize="12" />
                    <Button Content="Export..."     Click="OnSaveLog"      Padding="10,3" FontSize="12" />
                    <Button Content="Clear" Command="{Binding ClearLogCommand}" Padding="10,3" FontSize="12" />
                </StackPanel>
                <!-- Search + category filter fill remaining space -->
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="Debug Log" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center" />
                    <TextBox Width="200" Watermark="Search..."
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
                    <ComboBox Width="130"
                              ItemsSource="{Binding Categories}"
                              SelectedItem="{Binding SelectedCategory}" />
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Toolbar row 2: level toggles + auto-scroll -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                BorderBrush="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                BorderThickness="0,1,0,0"
                Padding="8,4">
            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBlock Text="Show:" VerticalAlignment="Center" FontSize="12" />
                <CheckBox Content="Debug"  IsChecked="{Binding ShowDebug}"   FontSize="12" />
                <CheckBox Content="Info"   IsChecked="{Binding ShowInfo}"    FontSize="12" />
                <CheckBox Content="Warn"   IsChecked="{Binding ShowWarning}" FontSize="12" />
                <CheckBox Content="Error"  IsChecked="{Binding ShowError}"   FontSize="12" />
                <ToggleSwitch Content="Auto-scroll" IsChecked="{Binding AutoScroll}"
                              FontSize="12" Margin="16,0,0,0" />
            </StackPanel>
        </Border>

        <!-- Log list fills all remaining space; ListBox has a built-in ScrollViewer -->
        <ListBox ItemsSource="{Binding FilteredEntries}"
                 x:Name="LogListBox"
                 Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                 Padding="4"
                 SelectionMode="Multiple"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 Margin="0">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Padding="2,1">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss.fff}'}"
                                       FontFamily="Cascadia Code, Consolas, Courier New, monospace"
                                       FontSize="12" VerticalAlignment="Center" />
                            <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                    CornerRadius="3" Padding="4,1">
                                <TextBlock Text="{Binding Category}" FontSize="11" VerticalAlignment="Center" />
                            </Border>
                            <TextBlock Text="{Binding Level}"
                                       FontSize="11" FontWeight="SemiBold" VerticalAlignment="Center" />
                            <SelectableTextBlock Text="{Binding Message}"
                                       FontFamily="Cascadia Code, Consolas, Courier New, monospace"
                                       FontSize="12" TextWrapping="NoWrap"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </DockPanel>
</Window>
